<!doctype html>
<html lang="ru">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="referrer" content="no-referrer">
  <title>Yandex.RTB R-A-14383531-2 (feed)</title>
  <style>
    html, body {
      margin: 0;
      padding: 0;
      background: #fff;
      height: 100%;
    }
    /* Обёртка занимает всю область iframe */
    .wrap {
      width: 100%;
      height: 100%;
      margin: 0;
      box-sizing: border-box;
      overflow: auto; /* если лента длиннее контейнера — будет скролл */
    }
    #yandex_rtb_R-A-14383531-2 {
      width: 100%;
      height: 100%;
    }
    #fallback {
      display: none;
      align-items: center;
      justify-content: center;
      width: 100%;
      height: 100%;
      font: 14px/1.3 system-ui, -apple-system, "Segoe UI", Roboto, Arial;
    }
    .show { display: flex; }
  </style>
</head>
<body>
  <div class="wrap">
    <div id="yandex_rtb_R-A-14383531-2"></div>
    <div id="fallback">Реклама недоступна</div>
  </div>

  <script>
  (function(){
    const BLOCK_ID = "R-A-14383531-2";
    const RENDER_TO = "yandex_rtb_R-A-14383531-2";
    const CONTEXT_SRC = "https://yandex.ru/ads/system/context.js";
    const MAX_TRIES = 3;
    const RENDER_TIMEOUT = 2500;

    let tries = 0;
    let rendered = false;

    window.yaContextCb = window.yaContextCb || [];

    const slot = document.getElementById(RENDER_TO);
    const mo = new MutationObserver(function() {
      if (slot && slot.children.length > 0) {
        rendered = true;
        mo.disconnect();
      }
    });
    mo.observe(slot, { childList: true, subtree: true });

    function showFallback() {
      document.getElementById('fallback').classList.add('show');
    }

    function injectSdk() {
      const old = document.getElementById("ya-context-sdk");
      if (old) old.remove();

      const s = document.createElement("script");
      s.id = "ya-context-sdk";
      s.src = CONTEXT_SRC + "?v=" + Date.now();
      s.async = true;
      s.onerror = onTryFail;
      document.head.appendChild(s);
    }

    function renderOnce() {
      try {
        const config = {
          blockId: BLOCK_ID,
          renderTo: RENDER_TO,
          type: "feed"
        };

        if (window.Ya && window.Ya.Context && window.Ya.Context.AdvManager) {
          window.Ya.Context.AdvManager.render(config);
          setTimeout(function(){ if (!rendered) onTryFail(); }, RENDER_TIMEOUT);
        } else {
          window.yaContextCb.push(function(){
            try {
              window.Ya.Context.AdvManager.render(config);
              setTimeout(function(){ if (!rendered) onTryFail(); }, RENDER_TIMEOUT);
            } catch(e) { onTryFail(); }
          });
        }
      } catch(e) {
        onTryFail();
      }
    }

    function onTryFail() {
      if (rendered) return;
      if (++tries < MAX_TRIES) {
        injectSdk();
        setTimeout(renderOnce, 200);
      } else {
        showFallback();
      }
    }

    function start() {
      injectSdk();
      setTimeout(renderOnce, 200);
    }

    if (document.readyState === "loading") {
      document.addEventListener("DOMContentLoaded", start, { once: true });
    } else {
      start();
    }
  })();
  </script>
</body>
</html>
